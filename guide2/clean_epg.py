import xml.etree.ElementTree as ET
from tqdm import tqdm  # progress bar
import sys

# === CONFIG ===
SOURCE_FILE = "epg.xml"
OUTPUT_FILE = "clean_epg.xml"

# === FULL CHANNEL LIST ===
CHANNELS_TO_KEEP = [
    "24/7 ACTION",
    "24/7 ANIMATED SERIES",
    "24/7 ANIME ACTION",
    "24/7 ANIME CLASSICS",
    "24/7 ANIME MOVIES",
    "24/7 BLACK CINEMA",
    "24/7 CARTOON CLASSICS",
    "24/7 COMEDY SHOWS",
    "24/7 CRIME TV",
    "24/7 FAMILY",
    "24/7 HORROR SHOWS",
    "24/7 LOVE & ROMANCE",
    "24/7 SCI-FI CLASSICS",
    "24/7 TEEN DRAMAS",
    "48 HOURS",
    "4UV",
    "60 MINUTES",
    "ACCORDING TO JIM",
    "ACORN TV MYSTERIES",
    "ADULT ANIMATION",
    "AERIAL AMERICA",
    "ALASKA STATE TROOPERS",
    "ALF",
    "ALFRED HITCHCOCK PRESENTS",
    "ALIEN NATION BY DUST",
    "ALL REALITY WE TV",
    "ALL WEDDINGS WE TV",
    "ALL-OUT ALASKA",
    "AMERICA'S BOOK OF SECRETS",
    "AMERICA'S COURT",
    "AMERICA'S DUMBEST CRIMINALS",
    "AMERICAN CRIMES",
    "AMERICAN GLADIATORS",
    "AMERICAN JUSTICE",
    "AMERICAN NINJA WARRIOR",
    "AMERICAN RESTORATION",
    "ANGER MANAGEMENT",
    "ANTIQUES ROAD TRIP",
    "ANTIQUES ROADSHOW UK",
    "ANCIENT ALIENS",
    "ANCIENT DISCOVERIES",
    "ANCIENT SECRETS",
    "APPALACHIAN OUTLAWS",
    "ART OF CRIME",
    "AX MEN",
    "BACKROAD TRUCKERS",
    "BACKSTAGE",
    "BAD GIRLS CLUB",
    "BAR RESCUE",
    "BAYWATCH",
    "BEYOND BELIEF",
    "BID WARS",
    "BIZARRE FOODS WITH ANDREW ZIMMERN",
    "BLACK OPS",
    "BRAVO VAULT",
    "BRITBOX MYSTERIES",
    "BROADCAST HISTORY",
    "BUZZR",
    "BUYING ALASKA",
    "BUYING THE BAYOU",
    "CALIFORNIA DREAM EATS",
    "CANADA'S WORST DRIVER",
    "CANADIAN PICKERS",
    "CAR CHASE",
    "CARTOON CLASSICS",
    "CELEBRITY NAME GAME",
    "CATCH A SMUGGLER",
    "CHEATERS",
    "CHOPPERTOWNTV",
    "CITY CONFIDENTIAL",
    "CLASSIC DOCTOR WHO",
    "COLD CASE FILES",
    "COMBAT WAR CHANNEL",
    "COMEDY DYNAMICS",
    "CONFESS BY NOSEY",
    "CONTEST & GAME SHOWS",
    "COOKING WITH FIRE",
    "CORNER GAS",
    "COUNTING CARS",
    "COURT CAM",
    "COURT TV",
    "COURT TV LEGENDARY TRIALS",
    "CRIME & JUSTICE",
    "CRIME SCENES",
    "CRIME STORIES",
    "CRIME THRILLER",
    "CRIMINAL COURT",
    "CRUNCHYROLL",
    "CSI",
    "CURIOSITY STREAM",
    "DALLAS SWAT",
    "DANCE MOMS",
    "DATELINE 24/7",
    "DEAL OR NO DEAL",
    "DEAL ZONE",
    "DEATH VALLEY DAYS",
    "DEGRASSI",
    "DESIGNATED SURVIVOR",
    "DESTINATION FEAR",
    "DINOS 24/7",
    "DIVORCE COURT",
    "DOCUMENTARY+",
    "DOG THE BOUNTY HUNTER",
    "DOG WHISPERER WITH CESAR MILLAN",
    "DOVE TV",
    "DR G MEDICAL EXAMINER",
    "DR. PHIL",
    "DR. PHIL PRIMETIME ON MOJ",
    "DUCK DYNASTY",
    "E! KEEPING UP",
    "EL REY REBEL",
    "ELECTRIC NOW",
    "ELLEN DEGENERES",
    "EAT THE WORLD",
    "ENGINEERING CATASTROPHES",
    "EXTREME JOBS BY LIONSGATE",
    "EXTREME LOGGERS",
    "FAMILY FEUD",
    "FAMILY FEUD CLASSIC",
    "FAMILY UNSCRIPTED",
    "FARSCAPE",
    "FEAR FACTOR USA",
    "FILMRISE BRITISH TV",
    "FILMRISE CLASSIC TV WESTERNS",
    "FILMRISE CLASSIC TV WESTERNS ENCOREMERIT STREET",
    "FGTeeV",
    "FBI FILES",
    "FORBIDDEN HISTORY",
    "FORENSIC FILES",
    "GANGSTERS: AMERICA'S MOST...",
    "GENERAL HOSPITAL",
    "GHOST HUNTERS",
    "GET",
    "GET COMEDY",
    "GOLD RUSH",
    "GRAND DESIGNS",
    "GREEN ACRES",
    "GROWING UP HIP HOP WE",
    "HAUNTED HISTORY",
    "HARLEM",
    "HISTORY & UNDISCOVERED",
    "HISTORY COLD CASE",
    "HISTORY HIT CHANNEL",
    "HISTORY OF THE WORLD",
    "HISTORY UNTOLD",
    "HIGHWAY THRU HELL",
    "HUNTER X HUNTER",
    "ICE COLD GOLD",
    "ICE ROAD TRUCKERS",
    "IMPACT WRESTLING",
    "INSIDE AMERICAN MAFIA",
    "ISN'T IT ROMANTIC",
    "IT TAKES A KILLER",
    "JUDGE & JURY",
    "JUDY JUSTICE",
    "KIDS & FAMILY FUN",
    "KINGS OF PAIN",
    "LAW & CRIME",
    "LEVERAGE",
    "LIFE BELOW ZERO",
    "LIFE AND LEGEND OF WYATT EARP",
    "LIFE OF CRIME",
    "LOCKED UP ABROAD",
    "LOST WORLDS",
    "LOVE AFTER LOCKUP WE",
    "LOVE KILLS",
    "MAGELLANTV WILDEST",
    "MARVELLOUS MRS. M...",
    "MEATEATER",
    "MEGA DISASTERS",
    "MEMORY LANE",
    "MIDSOMER MURDERS",
    "MILITARY HEROES",
    "MODERN INNOVATIONS B...",
    "MODERN MARVELS",
    "MONSTERS ARE REAL",
    "MOOVIMEX",
    "MY FIRST PLACE",
    "MURDER, SHE WROTE",
    "MYSTERIES AT THE MUSEUM",
    "MYSTERIES OF THE ABANDONED",
    "MYSTERIOUS WORLDS",
    "MYSTERY SCIENCE THEATRE",
    "MYTHBUSTERS",
    "NARUTO",
    "NASH BRIDGES",
    "NASHVILLE",
    "NASA+",
    "NATIONAL LAMPOON",
    "NATIONAL PARK MYSTERIES",
    "NATURESCAPE",
    "NIKITA",
    "NIP/TUCK",
    "NOSTALGIC HITS",
    "NO RESERVATIONS",
    "NOSEY",
    "NYRD BLUE",
    "ODDITIES",
    "ON THE TELLY",
    "ONLY IN AMERICA",
    "OUTERSPHERE",
    "OUTLAW",
    "OVERTIME",
    "OXYGEN TRUE CRIME ARCHIVES",
    "PAW PATROL",
    "PAWS AND CLAWS",
    "PARANORMAL FILES",
    "PAWN STARS",
    "PERFORM",
    "PIXEL",
    "PLACES & SPACES",
    "POKÉMON",
    "PORTLANDIA",
    "POWER RANGERS",
    "PRIMETIME SOAPS",
    "PROJECT BLUE BOOK",
    "PROJECT RUNWAY",
    "PUREFLIX TV",
    "REAL CRIME",
    "REAL DETECTIVE",
    "REAL DISASTER CHANNEL",
    "REAL HOUSEWIVES VAULT",
    "REELZ FAMOUS AND INFAMOUS",
    "REUTERS 60",
    "REVRY",
    "RIFFTRAX",
    "RIVER MONSTERS",
    "ROAD WARS",
    "ROVR PETS",
    "RUSTIC RETREATS",
    "SAVED BY THE BELL",
    "SAY YES TO THE DRESS",
    "SCARES BY SHUDDER",
    "SCIENCE IS AMAZING",
    "SCRIPPS NEWS",
    "SECRETS OF THE BIBLE",
    "SHERIFFS: EL DORADO CO.",
    "SHOUT! MOVIES",
    "SILENT WITNESS & NEW TRICKS",
    "SLIGHTLY OFF IFC",
    "SNL VAULT",
    "STAR TREK",
    "STARGATE",
    "STARTALK",
    "STORIES BY AMC",
    "STRANGE EVIDENCE",
    "STRANGE WORLD",
    "SUPERMARKET SWEEP",
    "SUPER FREAKS",
    "SUPERNANNY",
    "SURVIVE OR DIE",
    "SURVIVOR",
    "SWEET ESCAPES",
    "SWERVE COMBAT",
    "TASTEMADE",
    "TASTEMADE HOME",
    "TASTEMADE TRAVEL",
    "TEEN WOLF",
    "THE ADDAMS FAMILY",
    "THE APPRENTICE",
    "THE ASYLUM MOVIE CHANNEL",
    "THE BIGGEST LOSER",
    "THE BOB ROSS CHANNEL",
    "THE CAROL BURNETT SHOW",
    "THE CHALLENGE",
    "THE CONNERS",
    "THE DEAD FILES",
    "THE DICK VAN DYKE SHOW",
    "THE DOCTORS",
    "THE DOG WHISPERER WIT...",
    "THE FBI",
    "THE FIRST 48 BY A&E",
    "THE GIRLS NEXT DOOR",
    "THE INCREDIBLE DR. POL",
    "THE JACK HANNA CHANN...",
    "THE MALLORCA FILES",
    "THE MARTHA STEWART CHANNEL",
    "THE NEW DETECTIVES",
    "THE OSBOURNES",
    "THE OUTER LIMITS",
    "THE OUTPOST",
    "THE PRACTICE",
    "THE PRICE IS RIGHT: DREW",
    "THE PRICE IS RIGHT: THE BARKER YEARS",
    "THE REAL MCCOYS",
    "THE REPAIR SHOP",
    "THE RIFLEMAN",
    "THE SAILOR MOON CHANNEL",
    "THE THREE STOOGES +",
    "THE WALKING DEAD CHA...",
    "THE WALKING DEAD UNIVERSE",
    "THE YOUNG RIDERS",
    "THIS OLD HOUSE",
    "THIS OLD HOUSE MAKERS...",
    "TMNT",
    "TO CATCH A SMUGGLER",
    "TOP CHEF VAULT",
    "TOP GEAR",
    "TRAILER PARK BOYS",
    "TRAVEL AND ADVENTURE",
    "TRIBUNAL JUSTICE",
    "TRUE CRIME & SCANDALS",
    "TRUE CRIME NOW",
    "TRUE HISTORY",
    "TU DISCOVERY",
    "TV CLASSICS",
    "TYLER PERRY’S LOVE THY...",
    "ULTRAMAN",
    "UNEXPLAINED ZONE",
    "UNIQUE LIVES",
    "UNSOLVED MYSTERIES",
    "VICE",
    "VICE NEWS",
    "WANTED: DEAD OR ALIVE",
    "WAYPOINT TV",
    "WEEDS AND NURSE JACKIE",
    "WELCOME HOME",
    "WICKED TUNA",
    "WIPEOUT",
    "WONDERS OF THE WOR...",
    "WONDERY EXHIBIT C TRU...",
    "WWE CHANNEL",
    "WORLD’S WILDEST POLICE VIDEOS",
    "XPLORATION STATION",
    "YOUNG ICONS",
    "Z LIVING",
    "ZUMBO’S JUST DESSERTS",
    "FILMRISE ACTION",
    "MIRAMAX MOVIE CHANNEL",
    "FILMRISE FREE MOVIES",
    "AT THE MOVIES",
    "UNIVERSAL MONSTERS",
    "MGM HORROR",
    "SCREAMBOX TV",
    "MOVIESPHERE",
    "UNIVERSAL MOVIES",
    "CINEVAULT",
    "CINEVAULT CLASSICS",
    "MGM ACTION",
    "MGM PRESENTS",
    "EPIX",
    "EPIX 2",
    "EPIX HITS",
    "EPIX DRIVE IN",
    "MOVIEPLEX",
    "SCREENPIX",
    "SCREENPIX ACTION",
    "SCREENPIX VOICES"
]

# === SCRIPT ===
try:
    tree = ET.parse(SOURCE_FILE)
except FileNotFoundError:
    print(f"Source file '{SOURCE_FILE}' not found.")
    sys.exit(1)

root = tree.getroot()

new_root = ET.Element("tv")  # new XML root
kept = 0

for channel in tqdm(root.findall("channel"), desc="Processing channels"):
    display_names = channel.findall("display-name")
    if len(display_names) < 2:
        continue
    second_name = display_names[1].text
    if any(name.lower() in second_name.lower() for name in CHANNELS_TO_KEEP):
        new_root.append(channel)
        kept += 1

ET.ElementTree(new_root).write(OUTPUT_FILE, encoding="utf-8", xml_declaration=True)

print(f"\nFinished! {kept}/{len(root.findall('channel'))} channels kept. Cleaned file saved as '{OUTPUT_FILE}'.")
